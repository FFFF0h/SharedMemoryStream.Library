using NUnit.Framework;
using System;
using System.Linq;
using Theraot.Core;

namespace Tests.Theraot.Core
{
    [TestFixture]
    internal partial class PrimeHelperTest
    {
        [Test]
        public void TestIsPrime()
        {
            var input = new int[]
            {
                18, 13, 68, 99, 93, 34, 11, 47, 64, 10,
                809, 3420, 9391, 8999, 5154, 8934, 5416, 5669, 2755, 3159,
                285080, 727881, 846232, 665370, 153194, 157833, 585896, 914054, 505284, 333258,
                49086597, 78119724, 76928802, 23260170, 1955743, 39360664, 10885879, 30169506, 65889970, 95425647,
                179424551, 179424571, 179424577, 179424601, 179424611, 179424617, 179424629, 179424667, 179424671, 179424673,
                1683899352, 883641873, 114883641, 1000000007, 1000000009, 1000000021, 1000000033, 1000000087, 1000000093, 2147483629
            };
            var output = new int[]
            {
                0, 1, 0, 0, 0, 0, 1, 1, 0, 0,
                1, 0, 1, 1, 0, 0, 0, 1, 0, 0,
                0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
                0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
                1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                0, 0, 0, 1, 1, 1, 1, 1, 1, 1
            };
            Assert.AreEqual(input.Length, output.Length, "setup");
            for (int index = 0; index < output.Length; index++)
            {
                Assert.AreEqual(output[index] == 1, PrimeHelper.IsPrime(input[index]));
            }
        }

        [Test]
        public void TestPrimeBounds()
        {
            // 2147483629 is tha last prime below int.MaxValue
            Assert.AreEqual(2, PrimeHelper.NextPrime(-1));
            Assert.AreEqual(3, PrimeHelper.NextPrime(2));
            Assert.Throws<OverflowException>(() => PrimeHelper.NextPrime(2147483629));

            // 2147483629 is tha last prime below int.MaxValue
            Assert.AreEqual(2, PrimeHelper.ToPrime(-1));
            Assert.AreEqual(2, PrimeHelper.ToPrime(2));
            Assert.AreEqual(2147483629, PrimeHelper.ToPrime(2147483629));
        }
        
        [Test]
        public void TestNextPrime()
        {
            var input = new int[]
            {
                18, 13, 68, 99, 93, 34, 11, 47, 64, 10,
                809, 3420, 9391, 8999, 5154, 8934, 5416, 5669, 2755, 3159,
                285080, 727881, 846232, 665370, 153194, 157833, 585896, 914054, 505284, 333258,
                49086597, 78119724, 76928802, 23260170, 1955743, 39360664, 10885879, 30169506, 65889970, 95425647,
                179424551, 179424571, 179424577, 179424601, 179424611, 179424617, 179424629, 179424667, 179424671, 179424673,
                1683899352, 883641873, 114883641, 1000000007, 1000000009, 1000000021, 1000000033, 1000000087, 1000000093
            };
            var output = new int[]
            {
                19, 17, 71, 101, 97, 37, 13, 53, 67, 11,
                811, 3433, 9397, 9001, 5167, 8941, 5417, 5683, 2767, 3163,
                285091, 727891, 846233, 665381, 153247, 157837, 585899, 914117, 505301, 333269,
                49086613, 78119749, 76928807, 23260187, 1955747, 39360683, 10885891, 30169523, 65889997, 95425663,
                179424571, 179424577, 179424601, 179424611, 179424617, 179424629, 179424667, 179424671, 179424673, 179424691,
                1683899359, 883641893, 114883661, 1000000009, 1000000021, 1000000033, 1000000087, 1000000093, 1000000097
            };
            Assert.AreEqual(input.Length, output.Length, "setup");
            for (int index = 0; index < output.Length; index++)
            {
                Assert.AreEqual(output[index], PrimeHelper.NextPrime(input[index]));
                Assert.IsTrue(PrimeHelper.IsPrime(output[index]));
            }
        }

        [Test]
        public void TestToPrime()
        {
            var input = new int[]
            {
                18, 13, 68, 99, 93, 34, 11, 47, 64, 10,
                809, 3420, 9391, 8999, 5154, 8934, 5416, 5669, 2755, 3159,
                285080, 727881, 846232, 665370, 153194, 157833, 585896, 914054, 505284, 333258,
                49086597, 78119724, 76928802, 23260170, 1955743, 39360664, 10885879, 30169506, 65889970, 95425647,
                179424551, 179424571, 179424577, 179424601, 179424611, 179424617, 179424629, 179424667, 179424671, 179424673,
                1683899352, 883641873, 114883641, 1000000007, 1000000009, 1000000021, 1000000033, 1000000087, 1000000093
            };
            var output = new int[]
            {
                19, 13, 71, 101, 97, 37, 11, 47, 67, 11,
                809, 3433, 9391, 8999, 5167, 8941, 5417, 5669, 2767, 3163,
                285091, 727891, 846233, 665381, 153247, 157837, 585899, 914117, 505301, 333269,
                49086613, 78119749, 76928807, 23260187, 1955747, 39360683, 10885891, 30169523, 65889997, 95425663,
                179424551, 179424571, 179424577, 179424601, 179424611, 179424617, 179424629, 179424667, 179424671, 179424673,
                1683899359, 883641893, 114883661, 1000000007, 1000000009, 1000000021, 1000000033, 1000000087, 1000000093
            };
            Assert.AreEqual(input.Length, output.Length, "setup");
            for (int index = 0; index < output.Length; index++)
            {
                Assert.AreEqual(output[index], PrimeHelper.ToPrime(input[index]));
                Assert.IsTrue(PrimeHelper.IsPrime(output[index]));
            }
        }
    }
}